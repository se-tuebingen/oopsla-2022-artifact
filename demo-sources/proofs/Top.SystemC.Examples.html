---
layout: coqdoc
parent: Proofs
---
<h1 class="libtitle">Top.SystemC.Examples</h1>

<div class="code">
</div>

<div class="doc">

<div class="source">
  The source of this file can be found on
  <a href="{{site.github}}/blob/main/coq/SystemC/Examples.v">Github</a>.
</div>
 
</div>
<div class="code">

<br/>

<br/>
</div>

<div class="doc">
<a name="lab184"></a><h1 class="section"><a name="examples"></a>  Examples</h1>

   This file contains some worked examples in Coq for System C. 
<div class="paragraph"> </div>

 As System C is concerned with tracking <i>effectful</i> computation,
    represented by a block type, we define a base block type <span class="inlinecode"><a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a></span>
    that is used to represent some ambient, global effectful operation
 perhaps for performing I/O.

<div class="paragraph"> </div>

    In System C, we could define <span class="inlinecode"><a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a></span> using the following:

<pre><code class="language-effekt">
interface S0 {
  def doSomething(): Int
}
</code></pre>


</div>
<div class="code">
<span class="id" title="keyword">Parameter</span> <a name="S0"><span class="id" title="axiom">S0</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#btyp"><span class="id" title="inductive">btyp</span></a>.<br/>
<span class="id" title="keyword">Parameter</span> <a name="S0Wf"><span class="id" title="axiom">S0Wf</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#wf_btyp"><span class="id" title="inductive">wf_btyp</span></a> <a class="idref" href="Top.SystemC.Definitions.html#empty"><span class="id" title="abbreviation">empty</span></a> <a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a>.<br/>
<span class="id" title="keyword">Parameter</span> <a name="S0Type"><span class="id" title="axiom">S0Type</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#btype"><span class="id" title="inductive">btype</span></a> <a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab185"></a><h2 class="section"><a name="examples-id"></a>  Identity on blocks</h2>

   Here is an example of a function which takes a block argument f of type <span class="inlinecode"><a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a></span> and boxes it.
    In System C, we could define this using the following:

<pre><code class="language-effekt">
def id {f : S0} {
  box f
}
</code></pre>
 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="id"><span class="id" title="definition">id</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#blk"><span class="id" title="inductive">blk</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#blk_babs"><span class="id" title="constructor">blk_babs</span></a> <a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_box"><span class="id" title="constructor">exp_box</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 0) (<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 0))).<br/>

<br/>
</div>

<div class="doc">
Naturally, it would have the type <tt>{f : S0} =&gt; S0 at {f}</tt>.  You can see this by hovering over
    <tt>id_typ</tt> in the following code block.

<pre><code class="language-effekt">
def show_typ() { val id_typ = id; () }
</code></pre>


</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="id_typ"><span class="id" title="definition">id_typ</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#btyp"><span class="id" title="inductive">btyp</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#typ_bfun"><span class="id" title="constructor">typ_bfun</span></a> <a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_capt"><span class="id" title="constructor">typ_capt</span></a> <a class="idref" href="Top.SystemC.Examples.html#S0"><span class="id" title="axiom">S0</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 0)).<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="id_typing"><span class="id" title="lemma">id_typing</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#empty"><span class="id" title="abbreviation">empty</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">blk</span></a> <a class="idref" href="Top.SystemC.Examples.html#id"><span class="id" title="definition">id</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#id_typ"><span class="id" title="definition">id_typ</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab186"></a><h2 class="section"><a name="examples-try"></a>  Effectful Handlers</h2>

   Next, we model a simple try-catch expression which simply returns a value.
    This, written in our language, looks like:

<pre><code class="language-effekt">
def try_return_immediate() {
  try {
    0
  } with cap : S0 {
    def doSomething() {
      1
    }
  }
}
</code></pre>

    As our formalism in Coq lacks integers (and other expression values), we model
    our expressions and expression values in Coq using a base expression type <span class="inlinecode"><a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a></span>
    and a singular inhabitant of that type, namely <span class="inlinecode"><a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a></span>.

<div class="paragraph"> </div>


</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="try_return_immediate_typ"><span class="id" title="definition">try_return_immediate_typ</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a name="try_return_param_type"><span class="id" title="definition">try_return_param_type</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a name="try_return_immediate"><span class="id" title="definition">try_return_immediate</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#stm_try"><span class="id" title="constructor">stm_try</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_param_type"><span class="id" title="definition">try_return_param_type</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_immediate_typ"><span class="id" title="definition">try_return_immediate_typ</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>) <span class="comment">(*&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>) <span class="comment">(*&nbsp;1&nbsp;*)</span>.<br/>

<br/>
</div>

<div class="doc">
As expected, that try statement returns an <tt>Int</tt> (in our formalism, a <span class="inlinecode"><a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a></span>). 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_return_immediate_typing"><span class="id" title="lemma">try_return_immediate_typing</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#empty"><span class="id" title="abbreviation">empty</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">stm</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_immediate"><span class="id" title="definition">try_return_immediate</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_immediate_typ"><span class="id" title="definition">try_return_immediate_typ</span></a>.<br/>

<br/>
</div>

<div class="doc">
And naturally, reduces to 0 (<span class="inlinecode"><a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a></span>) as the effect is never invoked.
    As an aside, we assume the existance of three unique, fresh labels, which
    are used by our reduction semantics to uniquely identify frames on the stack. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Parameter</span> <a name="l1"><span class="id" title="axiom">l1</span></a> <a name="l2"><span class="id" title="axiom">l2</span></a> <a name="l3"><span class="id" title="axiom">l3</span></a> : <a class="idref" href="Top.Util.Label.html#LabelImpl.label"><span class="id" title="axiom">label</span></a>.<br/>
<span class="id" title="keyword">Axiom</span> <a name="l1l2"><span class="id" title="axiom">l1l2</span></a> : <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="Top.SystemC.Examples.html#l2"><span class="id" title="axiom">l2</span></a>.<br/>
<span class="id" title="keyword">Axiom</span> <a name="l1l3"><span class="id" title="axiom">l1l3</span></a> : <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="Top.SystemC.Examples.html#l3"><span class="id" title="axiom">l3</span></a>.<br/>
<span class="id" title="keyword">Axiom</span> <a name="l2l3"><span class="id" title="axiom">l2l3</span></a> : <a class="idref" href="Top.SystemC.Examples.html#l2"><span class="id" title="axiom">l2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">≠</span></a> <a class="idref" href="Top.SystemC.Examples.html#l3"><span class="id" title="axiom">l3</span></a>.<br/>

<br/>
</div>

<div class="doc">
Now, the try expression then reduces to returning a value directly out of a handler frame. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_return_immediate_s1"><span class="id" title="lemma">try_return_immediate_s1</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_immediate"><span class="id" title="definition">try_return_immediate</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>) <span class="comment">(*&nbsp;1&nbsp;*)</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_param_type"><span class="id" title="definition">try_return_param_type</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_immediate_typ"><span class="id" title="definition">try_return_immediate_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a>.<br/>
</div>

<div class="doc">
...which, by our reduction rules, eliminates the handler frame from the top of the stack. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_return_immediate_s2"><span class="id" title="lemma">try_return_immediate_s2</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>) <span class="comment">(*&nbsp;1&nbsp;*)</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Examples.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Examples.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab187"></a><h2 class="section"><a name="examples-try-invoke"></a>  Invoking a handler</h2>

  
<div class="paragraph"> </div>

  Similarly, next we model a try statement which actually throws something.  In System C, this can be
  expressed using the following fragment:

<pre><code class="language-effekt">
def try_return_throw() {
  try {
    cap.doSomething()
  } with cap : S0 {
    def doSomething() {
      0
    }
  }
}
</code></pre>


</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="try_return_throw_typ"><span class="id" title="definition">try_return_throw_typ</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a name="try_return_throw_param_typ"><span class="id" title="definition">try_return_throw_param_typ</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a name="try_return_throw"><span class="id" title="definition">try_return_throw</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#stm_try"><span class="id" title="constructor">stm_try</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_param_typ"><span class="id" title="definition">try_return_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_typ"><span class="id" title="definition">try_return_throw_typ</span></a> <br/>
&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 0) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span>) <br/>
&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span>).<br/>

<br/>
</div>

<div class="doc">
Naturally, it still returns an Int/<span class="inlinecode"><a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a></span> though. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_return_throw_typing"><span class="id" title="lemma">try_return_throw_typing</span></a> : <a class="idref" href="Top.SystemC.Definitions.html#empty"><span class="id" title="abbreviation">empty</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">stm</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw"><span class="id" title="definition">try_return_throw</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_typ"><span class="id" title="definition">try_return_throw_typ</span></a>.<br/>

<br/>
</div>

<div class="doc">
The reduction steps for this expression are a bit more complicated.  First, a throw
    statement is reduced in the presence of a matching handler, which shifts evaluation
    to that handler and unwinds from there. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_return_throw_s1"><span class="id" title="lemma">try_return_throw_s1</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw"><span class="id" title="definition">try_return_throw</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_handler"><span class="id" title="constructor">blk_handler</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a>) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_param_typ"><span class="id" title="definition">try_return_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_typ"><span class="id" title="definition">try_return_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_return_throw_s2"><span class="id" title="lemma">try_return_throw_s2</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_handler"><span class="id" title="constructor">blk_handler</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a>) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Examples.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〈</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">throw</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">#</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">•</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Examples.html#Q"><span class="id" title="variable">Q</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_return_throw_s3"><span class="id" title="lemma">try_return_throw_s3</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〈</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">throw</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">#</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">•</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_param_typ"><span class="id" title="definition">try_return_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_typ"><span class="id" title="definition">try_return_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;0&nbsp;*)</span><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_param_typ"><span class="id" title="definition">try_return_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_return_throw_typ"><span class="id" title="definition">try_return_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a> .<br/>

<br/>
</div>

<div class="doc">
<a name="lab188"></a><h2 class="section"><a name="examples-try-invoke-2"></a>  Invoking a handler, redux</h2>

   This example is a little more complicated.  Here, we throw while evaluating a value-binder
    under the handler block.

<pre><code class="language-effekt">
def try_apply_throw() {
  try {
    val x = cap.doSomething();
    x
  } with cap : S0 {
    def doSomething() {
      1
    }
  }
}
</code></pre>
    

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> := <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a name="try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a> := <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a name="try_apply_throw"><span class="id" title="definition">try_apply_throw</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#stm_try"><span class="id" title="constructor">stm_try</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_val"><span class="id" title="constructor">stm_val</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 0) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>) <span class="comment">(*&nbsp;1&nbsp;*)</span>).<br/>

<br/>
</div>

<div class="doc">
Naturally, it returns an Int/<span class="inlinecode"><a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a></span> again. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_apply_throw_typing"><span class="id" title="lemma">try_apply_throw_typing</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#empty"><span class="id" title="abbreviation">empty</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">stm</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw"><span class="id" title="definition">try_apply_throw</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a>.<br/>

<br/>
</div>

<div class="doc">
The reduction steps for this statement are a little more complicated.  First,
    as before, we shift the try statement onto the stack as a handler frame. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_apply_throw_s1"><span class="id" title="lemma">try_apply_throw_s1</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw"><span class="id" title="definition">try_apply_throw</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_val"><span class="id" title="constructor">stm_val</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_handler"><span class="id" title="constructor">blk_handler</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a>) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
</div>

<div class="doc">
Next, we mark that we are evaluating a binding with a K frame.  
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_apply_throw_s2"><span class="id" title="lemma">try_apply_throw_s2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_val"><span class="id" title="constructor">stm_val</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_handler"><span class="id" title="constructor">blk_handler</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a>) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span>) (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_handler"><span class="id" title="constructor">blk_handler</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a>) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#K"><span class="id" title="constructor">K</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">((</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
</div>

<div class="doc">
We throw in the presence of a K frame and a matching H (handler) frame,
    which causes the K frame to be unwound... 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_apply_throw_s3"><span class="id" title="lemma">try_apply_throw_s3</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_handler"><span class="id" title="constructor">blk_handler</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a>) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#K"><span class="id" title="constructor">K</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">((</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〈</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">throw</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">#</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#K"><span class="id" title="constructor">K</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">((</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">•</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
</div>

<div class="doc">
We unwind the stack, building the resumption continuation as we go, denoted by • ...
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_apply_throw_s4"><span class="id" title="lemma">try_apply_throw_s4</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〈</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">throw</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">#</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#K"><span class="id" title="constructor">K</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">((</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">•</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〈</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">throw</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">#</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">•</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#K"><span class="id" title="constructor">K</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
</div>

<div class="doc">
... and when we get to the matching H frame, we shift it off to evaluate the corresponding
    handler. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_apply_throw_s5"><span class="id" title="lemma">try_apply_throw_s5</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〈</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">throw</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">#</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;()&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#H"><span class="id" title="constructor">H</span></a> <a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">•</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#K"><span class="id" title="constructor">K</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0) <span class="comment">(*&nbsp;x&nbsp;*)</span>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#451cabffa5606fdf421b1d78bf6b4957"><span class="id" title="notation">〉</span></a><a class="idref" href="Top.SystemC.Definitions.html#e92f2993feae095c395ce5261340adfe"><span class="id" title="notation">--&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〈</span></a> <a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a> <span class="comment">(*&nbsp;1&nbsp;*)</span><a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.SystemC.Definitions.html#top"><span class="id" title="abbreviation">top</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">|</span></a> <a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#l1"><span class="id" title="axiom">l1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_sig"><span class="id" title="constructor">bind_sig</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_param_typ"><span class="id" title="definition">try_apply_throw_param_typ</span></a> <a class="idref" href="Top.SystemC.Examples.html#try_apply_throw_typ"><span class="id" title="definition">try_apply_throw_typ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#8b2651044cf89693157aa065ea56f2b9"><span class="id" title="notation">〉</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab189"></a><h2 class="section"><a name="examples-capability-thread"></a>  Capability threading</h2>

   Here is a more complicated example, which threads and returns a capability
    through try/handle frames.

<pre><code class="language-effekt">
def cap_return() {
  try {
    interface S1 {
      def doSomethingElse(): Unit => Int at {cap}
    }

    val thunk = 
      try {
        def f() {
          cap.doSomething()
        }
        f
      } with cap2 : S1 {
        def doSomethingElse() {
          def g() {
            0
          }
          box {cap} g
        }
      };
    thunk()
  } with cap : S0 {
    def doSomething() {
      0
    }
  }
}
</code></pre>
    

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="cap_return_tm"><span class="id" title="definition">cap_return_tm</span></a> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;try&nbsp;{&nbsp;...&nbsp;*)</span><br/>
&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_try"><span class="id" title="constructor">stm_try</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;val&nbsp;thunk&nbsp;=&nbsp;...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_val"><span class="id" title="constructor">stm_val</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_capt"><span class="id" title="constructor">typ_capt</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_vfun"><span class="id" title="constructor">typ_vfun</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>) (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;try&nbsp;{&nbsp;...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_try"><span class="id" title="constructor">stm_try</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 0) <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;def&nbsp;f()&nbsp;{&nbsp;...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_def"><span class="id" title="constructor">stm_def</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 1) (<a class="idref" href="Top.SystemC.Definitions.html#typ_vfun"><span class="id" title="constructor">typ_vfun</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;cap.doSomething()&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#blk_vabs"><span class="id" title="constructor">blk_vabs</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_throw"><span class="id" title="constructor">stm_throw</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 1) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*}&nbsp;f&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_box"><span class="id" title="constructor">exp_box</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 0))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*}&nbsp;with&nbsp;cap2&nbsp;:&nbsp;S1&nbsp;{&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_box"><span class="id" title="constructor">exp_box</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#blk_vabs"><span class="id" title="constructor">blk_vabs</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>)))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*};&nbsp;thunk()&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_vapp"><span class="id" title="constructor">stm_vapp</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_unbox"><span class="id" title="constructor">blk_unbox</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0)) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>))<br/>
&nbsp;&nbsp;<span class="comment">(*}&nbsp;with&nbsp;cap&nbsp;:&nbsp;S0&nbsp;{&nbsp;...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>)).<br/>
&nbsp;&nbsp;<span class="comment">(*}*)</span><br/>

<br/>
</div>

<div class="doc">
Naturally, it is also well-typed. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="cap_return_typing0"><span class="id" title="lemma">cap_return_typing0</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <span class="id" title="var">T</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#styping"><span class="id" title="inductive">styping</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Examples.html#cap_return_tm"><span class="id" title="definition">cap_return_tm</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Examples.html#T"><span class="id" title="variable">T</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab190"></a><h2 class="section"><a name="examples-sugar"></a>  Desugaring block definitions</h2>

   Definitions can be desugared at some cost into block applications
    and boxes.  Note that we insert an <tt>unbox</tt> to work around
    System C's automatic box inferencing.

<pre><code class="language-effekt">
def using_def {c : S0} {
  def C() {
    c.doSomething();
    0
  }
  // body here...
  0
}

def sugar_def {c : S0} {
  (unbox {(C : () => Int at {c}) => 
    // body here
    0})
  (box {() => c.doSomething(); 0})
}
</code></pre>
        

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="sugar_def"><span class="id" title="definition">sugar_def</span></a> (<span class="id" title="var">C</span> : <a class="idref" href="Top.SystemC.CaptureSets.html#cap"><span class="id" title="inductive">cap</span></a>) (<span class="id" title="var">S1</span> : <a class="idref" href="Top.SystemC.Definitions.html#btyp"><span class="id" title="inductive">btyp</span></a>) (<span class="id" title="var">b</span> : <a class="idref" href="Top.SystemC.Definitions.html#blk"><span class="id" title="inductive">blk</span></a>) (<span class="id" title="var">s</span> : <a class="idref" href="Top.SystemC.Definitions.html#stm"><span class="id" title="inductive">stm</span></a>) : <a class="idref" href="Top.SystemC.Definitions.html#stm"><span class="id" title="inductive">stm</span></a> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_vapp"><span class="id" title="constructor">stm_vapp</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_vabs"><span class="id" title="constructor">blk_vabs</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_capt"><span class="id" title="constructor">typ_capt</span></a> <a class="idref" href="Top.SystemC.Examples.html#S1"><span class="id" title="variable">S1</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a>) <a class="idref" href="Top.SystemC.Examples.html#s"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Top.SystemC.Definitions.html#exp_box"><span class="id" title="constructor">exp_box</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a> <a class="idref" href="Top.SystemC.Examples.html#b"><span class="id" title="variable">b</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="sugar_var"><span class="id" title="definition">sugar_var</span></a> (<span class="id" title="var">x</span> : <a class="idref" href="Top.Util.Atom.html#AtomImpl.atom"><span class="id" title="axiom">atom</span></a>) : <a class="idref" href="Top.SystemC.Definitions.html#blk"><span class="id" title="inductive">blk</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#blk_unbox"><span class="id" title="constructor">blk_unbox</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_fvar"><span class="id" title="constructor">exp_fvar</span></a> <a class="idref" href="Top.SystemC.Examples.html#x"><span class="id" title="variable">x</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="sugar_def_typing"><span class="id" title="lemma">sugar_def_typing</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">L</span> <span class="id" title="var">E</span> <span class="id" title="var">R</span> <span class="id" title="var">b</span> <span class="id" title="var">s</span> (<span class="id" title="var">C</span> : <a class="idref" href="Top.SystemC.CaptureSets.html#cap"><span class="id" title="inductive">cap</span></a>) <span class="id" title="var">Q</span> <span class="id" title="var">S1</span> <span class="id" title="var">T2</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Examples.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="Top.SystemC.Definitions.html#11f615684d43d5ff020d0ffb9a3d8457"><span class="id" title="notation">|=</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#wf_cap"><span class="id" title="inductive">wf_cap</span></a> <a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#wf_cap"><span class="id" title="inductive">wf_cap</span></a> <a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="Top.SystemC.Examples.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">;</span></a> <a class="idref" href="Top.SystemC.Examples.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">blk</span></a> <a class="idref" href="Top.SystemC.Examples.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#S1"><span class="id" title="variable">S1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> : <a class="idref" href="Top.Util.Atom.html#AtomImpl.atom"><span class="id" title="axiom">atom</span></a>, <a class="idref" href="Top.SystemC.Examples.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Top.Util.Metatheory.html#afed8734a485685888dccb4f977f99dd"><span class="id" title="notation">`</span></a><a class="idref" href="Top.Util.Metatheory.html#afed8734a485685888dccb4f977f99dd"><span class="id" title="notation">notin</span></a><a class="idref" href="Top.Util.Metatheory.html#afed8734a485685888dccb4f977f99dd"><span class="id" title="notation">`</span></a> <a class="idref" href="Top.SystemC.Examples.html#L"><span class="id" title="variable">L</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">(</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">[</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#bind_val"><span class="id" title="constructor">bind_val</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_capt"><span class="id" title="constructor">typ_capt</span></a> <a class="idref" href="Top.SystemC.Examples.html#S1"><span class="id" title="variable">S1</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="Top.Util.Environment.html#1e2518ff2e78f907c94429897ac7861a"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">)</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.Examples.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">;</span></a> <a class="idref" href="Top.SystemC.Examples.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">stm</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Definitions.html#open_es"><span class="id" title="definition">open_es</span></a> <a class="idref" href="Top.SystemC.Examples.html#s"><span class="id" title="variable">s</span></a> <a class="idref" href="Top.SystemC.Examples.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">)</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#T2"><span class="id" title="variable">T2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.Examples.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">;</span></a> <a class="idref" href="Top.SystemC.Examples.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">stm</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#sugar_def"><span class="id" title="definition">sugar_def</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a> <a class="idref" href="Top.SystemC.Examples.html#S1"><span class="id" title="variable">S1</span></a> <a class="idref" href="Top.SystemC.Examples.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="Top.SystemC.Examples.html#s"><span class="id" title="variable">s</span></a><a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">)</span></a> <a class="idref" href="Top.SystemC.Definitions.html#9cede441202180a620a73f1df5e6bca6"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#T2"><span class="id" title="variable">T2</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="sugar_var_typing"><span class="id" title="lemma">sugar_var_typing</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">E</span> <span class="id" title="var">R</span> <span class="id" title="var">f</span> <span class="id" title="var">S1</span> <span class="id" title="var">C</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#wf_env"><span class="id" title="inductive">wf_env</span></a> <a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#wf_cap"><span class="id" title="inductive">wf_cap</span></a> <a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="Top.SystemC.Examples.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Examples.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="Top.SystemC.Definitions.html#11f615684d43d5ff020d0ffb9a3d8457"><span class="id" title="notation">|=</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.Util.Environment.html#binds"><span class="id" title="definition">binds</span></a> <a class="idref" href="Top.SystemC.Examples.html#f"><span class="id" title="variable">f</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#bind_val"><span class="id" title="constructor">bind_val</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_capt"><span class="id" title="constructor">typ_capt</span></a> <a class="idref" href="Top.SystemC.Examples.html#S1"><span class="id" title="variable">S1</span></a> <a class="idref" href="Top.SystemC.Examples.html#C"><span class="id" title="variable">C</span></a>)) <a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Examples.html#E"><span class="id" title="variable">E</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.Examples.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">blk</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">(</span></a><a class="idref" href="Top.SystemC.Examples.html#sugar_var"><span class="id" title="definition">sugar_var</span></a> <a class="idref" href="Top.SystemC.Examples.html#f"><span class="id" title="variable">f</span></a><a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">)</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#S1"><span class="id" title="variable">S1</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab191"></a><h2 class="section"><a name="examples-mutable-state"></a>  Local Mutable State</h2>

   Finally, we formalize an example which models local, bounded mutable
    state.

<pre><code class="language-effekt">
interface ExampleCounter {
  def tick() : Int
}

def handleTick {prog : {() => Int} => Int} : Int {
  val stateFun = try {
    val res = prog {() => counter.tick()};
    box { prog } {(s : Int) => res}
  } with counter : ExampleCounter {
    def tick() {
      box { prog } {(s : Int) => (unbox resume(s))(s + 1)}
    }
  };
  (unbox stateFun)(0)
}
</code></pre>


</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="handle_tick_term"><span class="id" title="definition">handle_tick_term</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Top.SystemC.Definitions.html#blk_babs"><span class="id" title="constructor">blk_babs</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_bfun"><span class="id" title="constructor">typ_bfun</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_eff"><span class="id" title="constructor">typ_eff</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>) <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_val"><span class="id" title="constructor">stm_val</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#typ_capt"><span class="id" title="constructor">typ_capt</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_vfun"><span class="id" title="constructor">typ_vfun</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>) (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_try"><span class="id" title="constructor">stm_try</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 0) <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_val"><span class="id" title="constructor">stm_val</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_bapp"><span class="id" title="constructor">stm_bapp</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 1) (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 0) (<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_box"><span class="id" title="constructor">exp_box</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 1) (<a class="idref" href="Top.SystemC.Definitions.html#blk_vabs"><span class="id" title="constructor">blk_vabs</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 1))))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_val"><span class="id" title="constructor">stm_val</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#typ_capt"><span class="id" title="constructor">typ_capt</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#typ_vfun"><span class="id" title="constructor">typ_vfun</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a>) (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_vapp"><span class="id" title="constructor">stm_vapp</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_bvar"><span class="id" title="constructor">blk_bvar</span></a> 0) (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_ret"><span class="id" title="constructor">stm_ret</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#exp_box"><span class="id" title="constructor">exp_box</span></a> (<a class="idref" href="Top.SystemC.CaptureSets.html#cset_bvar"><span class="id" title="definition">cset_bvar</span></a> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#blk_vabs"><span class="id" title="constructor">blk_vabs</span></a> <a class="idref" href="Top.SystemC.Definitions.html#typ_base"><span class="id" title="constructor">typ_base</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#stm_vapp"><span class="id" title="constructor">stm_vapp</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_unbox"><span class="id" title="constructor">blk_unbox</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0)))))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Top.SystemC.Definitions.html#stm_vapp"><span class="id" title="constructor">stm_vapp</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#blk_unbox"><span class="id" title="constructor">blk_unbox</span></a> (<a class="idref" href="Top.SystemC.Definitions.html#exp_bvar"><span class="id" title="constructor">exp_bvar</span></a> 0)) <a class="idref" href="Top.SystemC.Definitions.html#exp_const"><span class="id" title="constructor">exp_const</span></a>)).<br/>
<span class="id" title="keyword">Lemma</span> <a name="handle_tick_term_typing"><span class="id" title="lemma">handle_tick_term_typing</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <span class="id" title="var">T</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Top.SystemC.Definitions.html#empty"><span class="id" title="abbreviation">empty</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">@</span></a> <a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">{}</span></a><a class="idref" href="Top.SystemC.CaptureSets.html#c345676e3b4c0f0924b673b43219aba7"><span class="id" title="notation">C</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">|-</span></a><a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">blk</span></a> <a class="idref" href="Top.SystemC.Examples.html#handle_tick_term"><span class="id" title="definition">handle_tick_term</span></a> <a class="idref" href="Top.SystemC.Definitions.html#b0e42b705cf240294735f1d77c92cb6a"><span class="id" title="notation">~:</span></a> <a class="idref" href="Top.SystemC.Examples.html#T"><span class="id" title="variable">T</span></a>.<br/>

<br/>
</div>
